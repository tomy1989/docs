---
title: 'Media Upload Guide'
description: 'Learn how to upload and manage media files for use in WhatsApp messages'
icon: 'cloud-arrow-up'
---

This guide covers everything you need to know about uploading and managing media files in the MegaSend Media Library. Learn best practices, common workflows, and optimization techniques.

## Overview

The Media Library provides centralized management for all media files used in your WhatsApp messages. Upload files once and reuse them across multiple messages, templates, and campaigns.

### Key Benefits

- **Upload once, use many times** - Save bandwidth and time
- **Track usage statistics** - See which media performs best
- **Organize with tags** - Categorize files by campaign, product, or purpose
- **Automatic expiry management** - Get notified before files expire
- **Centralized storage** - All your media in one searchable location

---

## Quick Start

### 1. Upload Your First File

<CodeGroup>

```bash cURL
curl -X POST "https://api.megasend.co.il/media-library/YOUR_INSTANCE_ID/upload" \
  -H "X-MEGASEND-AUTH: YOUR_ACCESS_TOKEN" \
  -F "file=@/path/to/product-image.jpg" \
  -F "description=Summer collection hero image" \
  -F "tags=summer,collection,hero"
```

```javascript JavaScript
const formData = new FormData();
formData.append('file', document.getElementById('fileInput').files[0]);
formData.append('description', 'Summer collection hero image');
formData.append('tags', 'summer,collection,hero');

const response = await fetch(
  'https://api.megasend.co.il/media-library/YOUR_INSTANCE_ID/upload',
  {
    method: 'POST',
    headers: {
      'X-MEGASEND-AUTH': 'YOUR_ACCESS_TOKEN'
    },
    body: formData
  }
);

const media = await response.json();
console.log('Uploaded media ID:', media.id);
```

```python Python
import requests

with open('/path/to/product-image.jpg', 'rb') as f:
    files = {'file': f}
    data = {
        'description': 'Summer collection hero image',
        'tags': 'summer,collection,hero'
    }

    response = requests.post(
        'https://api.megasend.co.il/media-library/YOUR_INSTANCE_ID/upload',
        headers={'X-MEGASEND-AUTH': 'YOUR_ACCESS_TOKEN'},
        files=files,
        data=data
    )

    media = response.json()
    print(f"Uploaded media ID: {media['id']}")
```

</CodeGroup>

### 2. Use in a Message

Once uploaded, use the `meta_media_id` in your messages:

```javascript
const message = {
  instance_id: 'YOUR_INSTANCE_ID',
  recipient: '+1234567890',
  message_type: 'image',
  image: {
    id: media.meta_media_id,  // Use the Meta media ID from upload response
    caption: 'Check out our summer collection!'
  }
};

await fetch('https://api.megasend.co.il/messages/send', {
  method: 'POST',
  headers: {
    'X-MEGASEND-AUTH': 'YOUR_ACCESS_TOKEN',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(message)
});
```

---

## Common Workflows

### Workflow 1: Managing a Media Library

Perfect for marketing teams managing product images, catalogs, and promotional materials.

```javascript
// 1. Upload product images with tags
async function uploadProductImages(productId, images) {
  const uploadedMedia = [];

  for (const image of images) {
    const formData = new FormData();
    formData.append('file', image);
    formData.append('description', `Product ${productId} image`);
    formData.append('tags', `product,${productId},catalog`);

    const response = await fetch(
      `https://api.megasend.co.il/media-library/${instanceId}/upload`,
      {
        method: 'POST',
        headers: { 'X-MEGASEND-AUTH': token },
        body: formData
      }
    );

    uploadedMedia.push(await response.json());
  }

  return uploadedMedia;
}

// 2. Find media by tag when sending messages
async function getProductMedia(productId) {
  const params = new URLSearchParams({
    tags: `product,${productId}`,
    file_type: 'image',
    sort_by: 'usage_count',
    order: 'desc',
    limit: 5
  });

  const response = await fetch(
    `https://api.megasend.co.il/media-library/${instanceId}/list?${params}`,
    {
      headers: { 'X-MEGASEND-AUTH': token }
    }
  );

  const { items } = await response.json();
  return items;
}

// 3. Send message with most-used product image
async function sendProductMessage(recipient, productId) {
  const mediaList = await getProductMedia(productId);

  if (mediaList.length > 0) {
    const topImage = mediaList[0];

    await fetch('https://api.megasend.co.il/messages/send', {
      method: 'POST',
      headers: {
        'X-MEGASEND-AUTH': token,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        instance_id: instanceId,
        recipient: recipient,
        message_type: 'image',
        image: {
          id: topImage.meta_media_id,
          caption: `Check out product #${productId}!`
        }
      })
    });
  }
}
```

---

### Workflow 2: Template Media Upload

Upload media specifically for use in WhatsApp Business templates.

```python
import requests
from typing import Dict

class TemplateMediaManager:
    def __init__(self, token: str, instance_id: str):
        self.token = token
        self.instance_id = instance_id
        self.base_url = 'https://api.megasend.co.il'

    def upload_template_header_image(
        self,
        template_name: str,
        image_path: str
    ) -> Dict:
        """Upload an image for use in template header"""

        with open(image_path, 'rb') as f:
            files = {'file': f}
            data = {
                'description': f'Header image for template: {template_name}',
                'tags': f'template,header,{template_name}'
            }

            response = requests.post(
                f'{self.base_url}/media-library/{self.instance_id}/upload',
                headers={'X-MEGASEND-AUTH': self.token},
                files=files,
                data=data
            )

            return response.json()

    def get_template_media(self, template_name: str) -> list:
        """Find all media for a specific template"""

        params = {
            'tags': f'template,{template_name}',
            'sort_by': 'upload_date',
            'order': 'desc'
        }

        response = requests.get(
            f'{self.base_url}/media-library/{self.instance_id}/list',
            headers={'X-MEGASEND-AUTH': self.token},
            params=params
        )

        return response.json()['items']

# Usage
manager = TemplateMediaManager(token='YOUR_TOKEN', instance_id='YOUR_INSTANCE_ID')

# Upload header image for welcome template
media = manager.upload_template_header_image(
    template_name='welcome_message',
    image_path='./assets/welcome-banner.jpg'
)

print(f"Upload successful! Meta Media ID: {media['meta_media_id']}")

# Use in template message
template_message = {
    'instance_id': 'YOUR_INSTANCE_ID',
    'recipient': '+1234567890',
    'message_type': 'template',
    'template': {
        'name': 'welcome_message',
        'language': 'en',
        'components': [
            {
                'type': 'header',
                'parameters': [
                    {
                        'type': 'image',
                        'image': {
                            'id': media['meta_media_id']  # Use uploaded media ID
                        }
                    }
                ]
            }
        ]
    }
}
```

---

### Workflow 3: Bulk Message Campaign with Media

Send personalized messages with media to multiple recipients.

```javascript
class CampaignManager {
  constructor(token, instanceId) {
    this.token = token;
    this.instanceId = instanceId;
    this.baseUrl = 'https://api.megasend.co.il';
  }

  async uploadCampaignMedia(campaignName, files) {
    const uploadedMedia = [];

    for (const file of files) {
      const formData = new FormData();
      formData.append('file', file);
      formData.append('description', `Campaign: ${campaignName}`);
      formData.append('tags', `campaign,${campaignName},${new Date().getFullYear()}`);

      const response = await fetch(
        `${this.baseUrl}/media-library/${this.instanceId}/upload`,
        {
          method: 'POST',
          headers: { 'X-MEGASEND-AUTH': this.token },
          body: formData
        }
      );

      uploadedMedia.push(await response.json());

      // Respect rate limits: wait 2 seconds between uploads
      await new Promise(resolve => setTimeout(resolve, 2000));
    }

    return uploadedMedia;
  }

  async sendCampaignMessages(campaignName, recipients) {
    // Get campaign media
    const params = new URLSearchParams({
      tags: `campaign,${campaignName}`,
      file_type: 'image',
      limit: 1
    });

    const response = await fetch(
      `${this.baseUrl}/media-library/${this.instanceId}/list?${params}`,
      {
        headers: { 'X-MEGASEND-AUTH': this.token }
      }
    );

    const { items } = await response.json();

    if (items.length === 0) {
      throw new Error('No media found for campaign');
    }

    const campaignMedia = items[0];

    // Send to all recipients
    const results = [];

    for (const recipient of recipients) {
      const message = {
        instance_id: this.instanceId,
        recipient: recipient.phone,
        message_type: 'image',
        image: {
          id: campaignMedia.meta_media_id,
          caption: `Hi ${recipient.name}! ${recipient.customMessage}`
        }
      };

      const sendResponse = await fetch(
        `${this.baseUrl}/messages/send`,
        {
          method: 'POST',
          headers: {
            'X-MEGASEND-AUTH': this.token,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(message)
        }
      );

      results.push({
        recipient: recipient.phone,
        status: sendResponse.ok ? 'sent' : 'failed',
        response: await sendResponse.json()
      });

      // Rate limiting: wait between sends
      await new Promise(resolve => setTimeout(resolve, 1000));
    }

    return results;
  }
}

// Usage
const campaign = new CampaignManager('YOUR_TOKEN', 'YOUR_INSTANCE_ID');

// Upload campaign images
const files = [
  document.getElementById('heroImage').files[0],
  document.getElementById('productImage').files[0]
];

const media = await campaign.uploadCampaignMedia('summer-sale-2024', files);

// Send to recipients
const recipients = [
  { phone: '+1234567890', name: 'John', customMessage: 'Special 20% off for you!' },
  { phone: '+0987654321', name: 'Jane', customMessage: 'Limited time offer!' }
];

const results = await campaign.sendCampaignMessages('summer-sale-2024', recipients);
console.log(`Sent ${results.length} messages`);
```

---

## File Requirements & Optimization

### Image Files

**Supported Formats**: JPEG, PNG, WebP
**Maximum Size**: 5 MB
**Recommended Dimensions**: 1080px width for high quality

#### Optimization Tips

```javascript
// Client-side image compression before upload
async function compressImage(file, maxWidth = 1080, quality = 0.85) {
  return new Promise((resolve) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);

    reader.onload = (event) => {
      const img = new Image();
      img.src = event.target.result;

      img.onload = () => {
        const canvas = document.createElement('canvas');

        // Calculate new dimensions
        let width = img.width;
        let height = img.height;

        if (width > maxWidth) {
          height = (height * maxWidth) / width;
          width = maxWidth;
        }

        canvas.width = width;
        canvas.height = height;

        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, width, height);

        canvas.toBlob(
          (blob) => {
            resolve(new File([blob], file.name, {
              type: 'image/jpeg',
              lastModified: Date.now()
            }));
          },
          'image/jpeg',
          quality
        );
      };
    };
  });
}

// Usage
const originalFile = fileInput.files[0];
const compressedFile = await compressImage(originalFile);
console.log(`Reduced from ${originalFile.size} to ${compressedFile.size} bytes`);
```

### Video Files

**Supported Formats**: MP4, 3GPP
**Maximum Size**: 16 MB
**Recommended Duration**: Under 60 seconds
**Codec**: H.264 for best compatibility

#### Video Optimization

Use FFmpeg to optimize videos before upload:

```bash
# Compress video to under 16MB while maintaining quality
ffmpeg -i input.mp4 \
  -c:v libx264 \
  -crf 28 \
  -preset medium \
  -c:a aac \
  -b:a 128k \
  -movflags +faststart \
  output.mp4

# Check file size
ls -lh output.mp4
```

### Document Files

**Supported Formats**: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT
**Maximum Size**: 100 MB
**Best Practice**: Keep under 10 MB for faster delivery

#### PDF Optimization

```python
# Python script to compress PDFs
from PyPDF2 import PdfReader, PdfWriter

def compress_pdf(input_path, output_path):
    reader = PdfReader(input_path)
    writer = PdfWriter()

    for page in reader.pages:
        page.compress_content_streams()
        writer.add_page(page)

    with open(output_path, 'wb') as f:
        writer.write(f)

# Usage
compress_pdf('large-catalog.pdf', 'catalog-compressed.pdf')
```

### Audio Files

**Supported Formats**: AAC, MP4, MPEG, AMR, OGG
**Maximum Size**: 16 MB
**Recommended Bitrate**: 128 kbps for voice, 256 kbps for music

---

## Managing Media Lifecycle

### Understanding Media Expiry

WhatsApp media expires **30 days after upload**. The Media Library tracks this automatically:

- **Active** (30-7 days remaining): Ready to use
- **Expiring Soon** (7-0 days remaining): Re-upload recommended
- **Expired** (past 30 days): Cannot be used, must re-upload

### Monitor Expiring Media

```javascript
async function getExpiringMedia() {
  const response = await fetch(
    `https://api.megasend.co.il/media-library/${instanceId}/list?status=expiring_soon`,
    {
      headers: { 'X-MEGASEND-AUTH': token }
    }
  );

  const { items } = await response.json();

  console.log(`${items.length} media files expiring soon:`);
  items.forEach(media => {
    const daysLeft = Math.ceil(
      (new Date(media.expiry_date) - new Date()) / (1000 * 60 * 60 * 24)
    );
    console.log(`- ${media.filename}: ${daysLeft} days left`);
  });

  return items;
}
```

### Auto-Renewal Strategy

```javascript
async function renewMedia(mediaId) {
  // 1. Get original media details
  const detailsResponse = await fetch(
    `https://api.megasend.co.il/media-library/item/${mediaId}`,
    {
      headers: { 'X-MEGASEND-AUTH': token }
    }
  );

  const media = await detailsResponse.json();

  // 2. Download the file
  const downloadResponse = await fetch(
    `https://api.megasend.co.il/media-library/item/${mediaId}/download`,
    {
      headers: { 'X-MEGASEND-AUTH': token }
    }
  );

  const blob = await downloadResponse.blob();
  const file = new File([blob], media.filename, { type: media.mime_type });

  // 3. Re-upload with same metadata
  const formData = new FormData();
  formData.append('file', file);
  formData.append('description', media.description);
  formData.append('tags', media.tags.join(','));

  const uploadResponse = await fetch(
    `https://api.megasend.co.il/media-library/${instanceId}/upload`,
    {
      method: 'POST',
      headers: { 'X-MEGASEND-AUTH': token },
      body: formData
    }
  );

  const newMedia = await uploadResponse.json();

  // 4. Delete old media
  await fetch(
    `https://api.megasend.co.il/media-library/item/${mediaId}?delete_from_meta=true`,
    {
      method: 'DELETE',
      headers: { 'X-MEGASEND-AUTH': token }
    }
  );

  console.log(`Renewed ${media.filename} - New ID: ${newMedia.id}`);
  return newMedia;
}
```

---

## Best Practices

### 1. Organize with Tags

Use a consistent tagging system:

```javascript
// Good tagging examples
const tags = [
  'campaign,summer-2024,promo',           // Campaign materials
  'product,widget-pro,hero-image',        // Product images
  'template,welcome,header',              // Template media
  'support,faq,diagram',                  // Support materials
  'seasonal,holiday,christmas-2024'       // Seasonal content
];
```

### 2. Descriptive Naming

Write clear descriptions that help your team:

```javascript
// Good descriptions
const goodDescriptions = [
  'Summer sale hero banner - 30% off promotion',
  'Product X user manual - Version 2.1',
  'Customer onboarding video - Step 1 of 5',
  'Invoice template header logo - High resolution'
];

// Poor descriptions
const poorDescriptions = [
  'image',
  'file1',
  'document',
  'video'
];
```

### 3. Regular Cleanup

Remove unused media monthly:

```javascript
async function cleanupUnusedMedia(maxUsageCount = 0, olderThanDays = 90) {
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - olderThanDays);

  const params = new URLSearchParams({
    sort_by: 'usage_count',
    order: 'asc',
    limit: 100
  });

  const response = await fetch(
    `https://api.megasend.co.il/media-library/${instanceId}/list?${params}`,
    {
      headers: { 'X-MEGASEND-AUTH': token }
    }
  );

  const { items } = await response.json();

  const toDelete = items.filter(media =>
    media.usage_count <= maxUsageCount &&
    new Date(media.upload_date) < cutoffDate
  );

  if (toDelete.length > 0) {
    const mediaIds = toDelete.map(m => m.id);

    await fetch(
      'https://api.megasend.co.il/media-library/bulk-delete',
      {
        method: 'POST',
        headers: {
          'X-MEGASEND-AUTH': token,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          media_ids: mediaIds,
          delete_from_meta: true
        })
      }
    );

    console.log(`Cleaned up ${toDelete.length} unused media files`);
  }
}
```

### 4. Monitor Usage Statistics

Track which media performs best:

```javascript
async function getMediaPerformance() {
  const statsResponse = await fetch(
    `https://api.megasend.co.il/media-library/${instanceId}/stats`,
    {
      headers: { 'X-MEGASEND-AUTH': token }
    }
  );

  const stats = await statsResponse.json();

  console.log('Media Library Performance:');
  console.log(`- Total files: ${stats.total_media}`);
  console.log(`- Total size: ${(stats.total_size_bytes / 1024 / 1024).toFixed(2)} MB`);
  console.log('\nBy Type:', stats.by_type);
  console.log('\nMost Used Media:');

  stats.most_used.forEach((media, index) => {
    console.log(`${index + 1}. ${media.filename} - ${media.usage_count} uses`);
  });
}
```

---

## Error Handling

### Handle Rate Limits

```javascript
async function uploadWithRateLimit(files) {
  const results = [];

  for (let i = 0; i < files.length; i++) {
    try {
      const formData = new FormData();
      formData.append('file', files[i]);

      const response = await fetch(
        `https://api.megasend.co.il/media-library/${instanceId}/upload`,
        {
          method: 'POST',
          headers: { 'X-MEGASEND-AUTH': token },
          body: formData
        }
      );

      if (response.status === 429) {
        // Rate limit hit - wait and retry
        const retryAfter = parseInt(response.headers.get('Retry-After') || '60');
        console.log(`Rate limit hit, waiting ${retryAfter} seconds...`);
        await new Promise(resolve => setTimeout(resolve, retryAfter * 1000));

        // Retry this file
        i--;
        continue;
      }

      results.push(await response.json());

      // Wait 2 seconds between uploads to avoid rate limits
      if (i < files.length - 1) {
        await new Promise(resolve => setTimeout(resolve, 2000));
      }

    } catch (error) {
      console.error(`Failed to upload ${files[i].name}:`, error);
      results.push({ error: error.message, filename: files[i].name });
    }
  }

  return results;
}
```

### Handle File Size Errors

```javascript
async function validateAndUpload(file) {
  const maxSizes = {
    'image': 5 * 1024 * 1024,      // 5 MB
    'video': 16 * 1024 * 1024,     // 16 MB
    'audio': 16 * 1024 * 1024,     // 16 MB
    'document': 100 * 1024 * 1024, // 100 MB
    'sticker': 500 * 1024          // 500 KB
  };

  const fileType = getFileType(file.type);
  const maxSize = maxSizes[fileType];

  if (file.size > maxSize) {
    throw new Error(
      `File too large: ${(file.size / 1024 / 1024).toFixed(2)} MB. ` +
      `Maximum for ${fileType}: ${(maxSize / 1024 / 1024).toFixed(2)} MB`
    );
  }

  // File is valid, upload
  const formData = new FormData();
  formData.append('file', file);

  const response = await fetch(
    `https://api.megasend.co.il/media-library/${instanceId}/upload`,
    {
      method: 'POST',
      headers: { 'X-MEGASEND-AUTH': token },
      body: formData
    }
  );

  return response.json();
}

function getFileType(mimeType) {
  if (mimeType.startsWith('image/')) return 'image';
  if (mimeType.startsWith('video/')) return 'video';
  if (mimeType.startsWith('audio/')) return 'audio';
  return 'document';
}
```

---

## Advanced Features

### Search and Filter

```javascript
// Find all product images from 2024
async function findProductImages2024() {
  const params = new URLSearchParams({
    file_type: 'image',
    tags: 'product,2024',
    sort_by: 'usage_count',
    order: 'desc'
  });

  const response = await fetch(
    `https://api.megasend.co.il/media-library/${instanceId}/list?${params}`,
    {
      headers: { 'X-MEGASEND-AUTH': token }
    }
  );

  return response.json();
}

// Search by filename
async function searchByFilename(searchTerm) {
  const params = new URLSearchParams({
    search: searchTerm,
    limit: 50
  });

  const response = await fetch(
    `https://api.megasend.co.il/media-library/${instanceId}/list?${params}`,
    {
      headers: { 'X-MEGASEND-AUTH': token }
    }
  );

  return response.json();
}
```

### Batch Processing

```javascript
async function batchUpdateTags(mediaIds, newTags) {
  const results = [];

  for (const id of mediaIds) {
    const response = await fetch(
      `https://api.megasend.co.il/media-library/item/${id}`,
      {
        method: 'PATCH',
        headers: {
          'X-MEGASEND-AUTH': token,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          tags: newTags
        })
      }
    );

    results.push(await response.json());
  }

  return results;
}

// Usage: Add 'featured' tag to top 10 most-used images
const stats = await getMediaPerformance();
const topIds = stats.most_used.slice(0, 10).map(m => m.id);
await batchUpdateTags(topIds, 'featured,top-performers,high-engagement');
```

---

## Next Steps

- [Media API Reference](/media/api-reference) - Complete API documentation
- [Send Messages with Media](/messages/send) - Use uploaded media in messages
- [Create Templates](/templates/create) - Add media to WhatsApp templates
- [Track Analytics](/analytics/overview) - Monitor media performance

<Note>
Need help? Contact support at support@megasend.com
</Note>
